<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Introduction to User JavaScript - Dev.Opera</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="L7q_7GF5c9d7ZAUYdfaTiRaB6sTAGv_cRz3nq5DsabM">
    <meta name="description" content="Dev.Opera is the ultimate source of distilled knowledge for web developers, covering the latest open web technologies and techniques including HTML5, CSS3, JavaScript, SVG, optimizing content for mobiles, tablets and TVs, and creating add-ons such as extensions and themes for the Opera browser.">
    <meta name="keywords" content="Opera, web, HTML5, HTML, CSS3, CSS, JavaScript, SVG, Geolocation, Widgets, Extensions, Unite, Mini, Mobile, web development, design, web design, tutorials, articles, examples, demos, web standards, open standards, open web, video, audio, getusermedia, accessibility, wai-aria, transitions, translations, microformats, microdata, dataset, media queries, viewport, @viewport, transparency, opacity, gradients, box-shadow, text-shadow, web fonts, appcache, websql, local storage, ajax, json, games, userjs, webgl, tv, tablet, emulator, skinning, themes, skins, drasgonfly, mathml, web sockets, operawatir">
    <link rel="icon" href="../../../../static.myopera.com/dev/img/speed_dial-icon.png" type="image/png">
    <link rel="apple-touch-icon" href="../../../../static.myopera.com/dev/img/touch-icon.png" type="image/png">
    <link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../../../static.myopera.com/dev/css/devopera.css" type="text/css">
    <!--[if IE 6]><link rel="stylesheet" href="/css/browsers/ie6.css" type="text/css"><![endif]-->
    <!--[if IE 7]><link rel="stylesheet" href="/css/browsers/ie7.css" type="text/css"><![endif]-->
    <!--[if IE 8]><link rel="stylesheet" href="/css/browsers/ie8.css" type="text/css"><![endif]-->
    <!--[if lte IE 8]><script type="text/javascript" src="/js/ie.js"></script><![endif]-->
    <link rel="stylesheet" href="../../../../static.myopera.com/dev/css/articles.css">
    <link rel="stylesheet" media="print" href="../../../../static.myopera.com/dev/css/print.css">
    <link rel="stylesheet" href="../../../../static.myopera.com/dev/css/github.css">
    <link rel="alternate" type="application/rss+xml" title="Recent articles - RSS 2.0 Feed" href="../../../feeds/rss/articles">
    <link rel="alternate" type="application/atom+xml" title="Recent articles - Atom 1.0 Feed" href="../../../feeds/atom/articles">
    <link rel="alternate" type="application/rss+xml" title="Recent articles in Web - RSS 2.0 Feed" href="../../../feeds/rss/articles/web">
    <link rel="alternate" type="application/atom+xml" title="Recent articles in Web - Atom 1.0 Feed" href="../../../feeds/atom/articles/web">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="../../../../static.myopera.com/dev/js/menu.js"></script>
    <noscript>
      <style type="text/css">
.collection ul li ul {
    display: inherit !important;
}
      </style>
    </noscript>
    <script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-4118503-4']);
_gaq.push(['_gat._anonymizeIp']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
    </script>

  </head>
  <body class="web">
    <header role="banner"  class="article-view" >
      <div>
        <a href="../../../index.html" id="logo">Dev.Opera</a>
        <form action="http://dev.opera.com/search" role="search">
          <fieldset>
            <label class="hidden" for="q">Search</label>
            <input type="text" name="q" maxlength="256" value="" id="q" required>
            <input type="submit" id="q-submit" value="Search" title="Search">
          </fieldset>
        </form>
        <p id="login">
          <a href="../../../../../https/dev.opera.com/login/index.html" accesskey="L" title="Log in">Log in</a>
        </p>
        <nav id="nav">
          <ul role="menu">

            <li role="menuitem"  class="selected">
              <a href="../../../web.html">Web</a>
            </li>
            <li role="menuitem" >
              <a href="../../../addons.1.html">Add-ons</a>
            </li>
            <li role="menuitem" >
              <a href="../../../mobile.html">Mobile</a>
            </li>
            <li role="menuitem" >
              <a href="../../../tv.html">TV</a>
            </li>
            <li role="menuitem" >
              <a href="../../../labs.html">Labs</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
<section id="content" role="main" class="asideleft">
  <section class="main">
    <article lang="en">
      <h1>Introduction to User JavaScript</h1>
      <p class="print author">By Zi Bin Cheah</p>

      <h2>Introduction</h2>
<p>
User JavaScript is an Opera feature allowing you to apply custom JavaScript to any pages you surf, giving you extra control over how sites are presented or loaded. There are many different reasons for you to apply custom JavaScript to web pages, including:</p>

<ol>
<li>
Preventing certain scripts from running: you could  write a User JavaScript to stop advertisement popups.
</li>
<li>
Fixing broken sites: Sometimes pages do not render correctly, and you could use User JavaScript to fix broken behavior on these sites.
</li>
<li>
Introducing extra scripts to the site or browser: you could  load a script to check what kind of user agent your browser is spoofing. 
</li>
</ol>

<p>In this article I will show you how to enable User JavaScript, how to configure Opera to run scripts only on certain domains, and how to create and use a simple example.</p>

<p class="note">Note that there are a lot more <a href="http://userjs.org/">User JavaScript resources available at userjs.org</a>, including lots of free scripts.</p>

<h2>Enabling User JavaScript</h2>

<p>The first thing to do is to check if User JavaScript is enabled in your installation of Opera. To do this, type “opera:about ” in the address bar and press return. If User JavaScript is enabled, the “User JavaScript files” path will be shown in the “Paths” section. If it is not, you can enable User JavaScript (and create a folder for your scripts to reside in) by selecting the following:</p>

<ul>
<li>On Mac, select “Opera &gt; Preferences” from the menus, then select the “Advanced” tab, and click on the “Content” option from the list of the left-hand side. Now click the “JavaScript options” button, and enter a path to where you want to store your User JavaScript files in the “User JavaScript files” input field. OK out of all the dialog boxes and check “opera:about ” again—you should see your “User JavaScript files” path in the “Paths” section.</li>
<li>On Windows and Linux, the instructions are exactly the same, except that the “Preferences” option is found under the “Tools” menu, not the “Opera” menu.</li>
</ul>

<h2>Creating and executing custom scripts</h2>

<p>Now you have User JavaScript enabled, it is time to look at how to actually use it. Bear in mind that all your User JavaScripts can sit in a single or multiple script files inside the folder you specified above. When a page is loaded into Opera and you have User JavaScript enabled, the script is automatically imported into and run against the page. You need to specify when different parts of the script are executed using <strong>event listeners</strong>, and which sites they are run against (if you only want certain parts to run against certain domains) using <strong>domain detection</strong>. Let’s look at both of these subjects now.</p>


<h3>Event Listeners</h3>

<p>An event listener is used to specify exactly when a function should be executed, in the course of the page being loaded. The basic event listener syntax is as follows:</p>

<pre><code>document.addEventListener(&#39;event&#39;, &#39;function&#39;, false);</code></pre>

<p>The arguments are:</p>

<ul>
<li><code>event</code>: This is what event should trigger the running of the function.</li>
<li><code>function</code>: This is the name of your function.</li>
<li><code>false</code>: This is actually a boolean, which can have the value <code>true</code> or <code>false</code>. This states whether the event handler should be executed <a href="http://www.quirksmode.org/js/events_order.html">in the capturing or the bubbling phase</a>.
If you’re not certain what these mean, and which one you should use, stick to a value of <code>false</code> (bubbling).</li>
</ul>

<p>The two most common events that you’ll want to fire functions against are <code>load</code>, which fires the function after the whole page has finished loading, and <code>DOMContentLoaded</code>, which specifies to run the function after the DOM has loaded with. There are <a href="http://www.opera.com/support/tutorials/userjs/specs/#evlistener">other event stages to run functions against</a> too—learn about these at the opera.com tutorials.</p>


<h3>Domain Detection</h3>

<p>By default, User JavaScript will be executed against all pages you visit in Opera. You will often find however that you want to execute certain functions only against specific domains—this can be done using domain detection.</p>

<p>There are a couple of ways to perform domain detection. The first one is to compare a string using <code>location.hostname.indexOf</code> in an <code>if</code> statement, like so:</p>

<pre><code>if (location.hostname.indexOf(&#39;opera.com&#39;) != -1)

{
  ...do stuff...
}
</code></pre>

<p>If the string “opera.com” appears in the URL, a match is detected, and the code inside the braces is run. This detects domains such as the following:</p>

<pre>www.opera.com/dir/subdir/
www.<em>subdomain</em>.opera.com</pre>

<p>However it will also detect this:</p>

<pre><code>www.anythingbeforeopera.com</code></pre>

<p>A more precise method of domain detection is to use a comparison involving <code>location.hostname</code> to match just the domain you want (eg below it is <code>opera.com</code>):</p> 

<pre><code>if( location.hostname == &#39;opera.com&#39; )

{
  ...do stuff...
}</code></pre>

<h2>Example</h2>
<p>This section will show both the above techniques in action, as well as teaching you how to create and run a simple User JavaScript. The example you will build is a User JavaScript that creates a bar at the bottom of the browser displaying the browser name, version, cookies and user agent. The basic logic flow of the script is thus:</p>

<ol>
<li>The script loads only if the user is accessing the www.opera.com web site.</li>
<li>The function is fired when the page has completely finished loading—this is triggered by an event listener that listens for the <code>load</code> event.</li>
<li>A <code>div</code> element is created using <code>document.createElement</code>—this element will act as the container for the tool bar.</li>
<li>In the <code>div</code> element, child nodes are created using DOM calls. These nodes will load JavaScript&#39;s <code>navigator</code> object to find out properties such as user agent, browser name, browser version and cookies.
</li>
</ol>

<p>To make use of this User JavaScript, simply copy and paste the code below into a plain text editor, and save it with a suitable name with a <code>.js</code> extension.</p>

<pre><code>if( location.hostname == &#39;www.opera.com&#39; )
{
  document.addEventListener (
    &#39;load&#39;,
    function (e) 
    {
      if( !document.body ) {
       return;
      }
    	
      var mydiv = document.createElement(&#39;div&#39;);
      mydiv.style.position = &#39;fixed&#39;;
      mydiv.style.bottom = &#39;0px&#39;;
      mydiv.style.border = &#39;1px solid #000&#39;;
      mydiv.style.backgroundColor = &#39;#fff&#39;;
      mydiv.style.color = &#39;#000&#39;;
      mydiv.appendChild(document.createTextNode(&quot;Browser: &quot; + navigator.appName))
      mydiv.appendChild(document.createTextNode(&quot;; Ver: &quot; + navigator.appVersion))
      mydiv.appendChild(document.createTextNode(&quot;; Cookies: &quot; + navigator.cookieEnabled))
      mydiv.appendChild(document.createTextNode(&quot;; User Agent: &quot; + navigator.userAgent))
    	
      document.body.appendChild(mydiv);
    },
    false
  );
}</code></pre>

<p>When you have done this, try it out by <a href="http://www.opera.com">navigating to www.opera.com</a>—you should see a browser information bar at the bottom of the web page, as seen in Figure 1.</p>

<img src="../../../../devfiles.myopera.com/articles/511/userjsbrowserinfo.gif" alt="browser information bar" />
<p class="comment">Figure 1: The browser information bar in action.</p>

<h2>Summary</h2>

<p>This article introduces User JavaScript and what it can do. Employing User JavaScript, you can employ greater control over web pages, fixing erronous behavior and improving your personal user experience. For more details, check out the <a href="http://www.opera.com/support/tutorials/userjs/">Opera documentation on User JavaScript</a>.</p>
    

      <section id="author-info">
        <h1><a href="../../../author/zibin.html" rel="author">Zi Bin Cheah</a></h1>
        <a href="../../../author/zibin.html" rel="author"><img src="../../../../../https/static.myopera.com/avatars/pool1/b2/3f7/b618249c2217ba63c74962f085feaa93ad5.jpg" alt=""/></a>
        <p>Web Evangelist in the Developer Relations Team at Opera Software ASA.</p>
        <br class="clear" />
      </section>
      <p id="license" class="info">This article is licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/" rel="license">Creative Commons Attribution, Non Commercial - Share Alike 2.5</a> license.</p>

    </article>
<section id="comments">
  <h2>Comments</h2>
      <p class="info">The forum archive of this article is still available on <a href="http://my.opera.com/community/forums/topic.dml?id=252430">My Opera</a>.</p>
  <ul>
  </ul>
No new comments accepted.
</section>

  </section>

  <aside>
    <section class="info">
      <p class="author"><strong>Author</strong> <a href="../../../author/zibin.html" rel="author">Zi Bin Cheah</a></p>
      <p>
        <strong>Date</strong>
        Wednesday, October 8, 2008
      </p>

      <p class="tags"><strong>Tags</strong></p>
      <ul class="tags">
        <li><a href="../../tags/javascript.html" rel="tag">javascript</a></li>
      </ul>
    </section>
  </aside>




</section>
<script type="text/javascript" src="../../../../static.myopera.com/dev/js/highlight.pack.js"></script>
<script type="text/javascript">hljs.initHighlightingOnLoad();</script>

    <footer>
      <section role="contentinfo">
        <ul>
          <li><a href="../../../help.html">Help/<abbr>FAQ</abbr></a>
          <li><a href="http://my.opera.com/community/terms-of-service/?utm_source=devopera&amp;utm_medium=footer&amp;utm_campaign=devlinks">Terms of service</a>
          <li><a href="../../../privacy.html">Privacy</a>
        </ul>
      </section>
    </footer>
  </body>
</html>
